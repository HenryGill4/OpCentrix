@* _ValidationScriptsPartial.cshtml *@
@* FIXED: Prevent double-loading of jQuery validation scripts *@

<script>
    // CRITICAL FIX: Only load validation scripts if not already loaded
    if (typeof jQuery === 'undefined') {
        console.error('[VALIDATION] CRITICAL: jQuery not loaded - validation will fail');
        document.body.innerHTML += '<div style="position: fixed; top: 0; left: 0; right: 0; background: red; color: white; padding: 10px; text-align: center; z-index: 99999;">ERROR: jQuery validation requires jQuery to be loaded first.</div>';
    } else if (typeof jQuery.validator === 'undefined') {
        console.error('[VALIDATION] CRITICAL: jQuery Validation plugin not found - loading from partial');
        
        // Load validation scripts if not already present
        var validationScript = document.createElement('script');
        validationScript.src = '@Url.Content("~/lib/jquery-validation/dist/jquery.validate.min.js")';
        validationScript.onload = function() {
            console.log('[VALIDATION] jQuery Validation loaded from partial');
            
            // Load unobtrusive validation after main validation
            var unobtrusiveScript = document.createElement('script');
            unobtrusiveScript.src = '@Url.Content("~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js")';
            unobtrusiveScript.onload = function() {
                console.log('[VALIDATION] jQuery Unobtrusive Validation loaded from partial');
                
                // Initialize validation for any forms on the page
                if (typeof jQuery.validator !== 'undefined') {
                    jQuery('form').each(function() {
                        jQuery.validator.unobtrusive.parse(this);
                    });
                    console.log('[VALIDATION] Form validation initialized');
                }
            };
            document.head.appendChild(unobtrusiveScript);
        };
        document.head.appendChild(validationScript);
    } else {
        console.log('[VALIDATION] jQuery Validation already loaded - skipping duplicate load');
        
        // Ensure unobtrusive validation is initialized for forms
        if (typeof jQuery.validator !== 'undefined' && typeof jQuery.validator.unobtrusive !== 'undefined') {
            jQuery(document).ready(function() {
                jQuery('form').each(function() {
                    jQuery.validator.unobtrusive.parse(this);
                });
                console.log('[VALIDATION] Form validation re-initialized from partial');
            });
        }
    }
</script>

@* Enhanced validation error styling for better UX *@
<style>
    .field-validation-error {
        color: #e53e3e;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: block;
    }
    
    .input-validation-error {
        border-color: #e53e3e !important;
        box-shadow: 0 0 0 1px #e53e3e !important;
    }
    
    .validation-summary-errors {
        background-color: #fed7d7;
        border: 1px solid #feb2b2;
        border-radius: 0.375rem;
        padding: 0.75rem;
        margin-bottom: 1rem;
        color: #742a2a;
    }
    
    .validation-summary-errors ul {
        margin: 0;
        padding-left: 1.25rem;
    }
    
    .validation-summary-errors li {
        margin-bottom: 0.25rem;
    }
</style>
