@model OpCentrix.Models.Job
@{
    // Task 9: Enhanced job block with comprehensive data attributes for styling
    var statusClass = Model.Status.ToLower().Replace(" ", "-");
    var priorityIndicator = Model.Priority switch {
        1 => "??", // Critical
        2 => "??", // High  
        3 => "??", // Normal
        4 => "??", // Low
        5 => "??", // Lowest
        _ => "?"
    };
    
    var materialClass = Model.SlsMaterial?.ToLower().Contains("ti") == true ? "titanium" : 
                       Model.SlsMaterial?.ToLower().Contains("inconel") == true ? "inconel" : "standard";
                       
    var progressPercent = Model.Status.ToLower() switch {
        "completed" => 100,
        "running" or "building" => 65,
        "cooling" => 85,
        "post-processing" => 95,
        "scheduled" => 0,
        _ => 0
    };
    
    // Determine department from job type or machine
    var department = Model.MachineId?.Contains("TI") == true ? "Printing" :
                    Model.MachineId?.Contains("INC") == true ? "Printing" :
                    Model.MachineId?.Contains("EDM") == true ? "EDM" :
                    Model.MachineId?.Contains("CNC") == true ? "Assembly" : "General";
}

<div class="job-block-content">
    <!-- Job Header with Priority and Title -->
    <div class="job-block-title">
        @if (Model.Priority <= 2)
        {
            <span class="priority-indicator">@priorityIndicator</span>
        }
        @Model.PartNumber
        @if (Model.IsRushJob)
        {
            <span class="rush-indicator">?</span>
        }
    </div>
    
    <!-- Job Details -->
    <div class="job-block-subtitle">
        @if (!string.IsNullOrEmpty(Model.SlsMaterial))
        {
            <span class="material-info">@Model.SlsMaterial.Substring(0, Math.Min(Model.SlsMaterial.Length, 15))@(Model.SlsMaterial.Length > 15 ? "..." : "")</span>
        }
    </div>
    
    <!-- Job Meta Information -->
    <div class="job-block-meta">
        <span class="duration-info">@Model.DurationHours.ToString("F1")h</span>
        <span class="quantity-info">Qty: @Model.Quantity</span>
    </div>
    
    <!-- Progress Bar for Active Jobs -->
    @if (progressPercent > 0)
    {
        <div class="job-progress-bar" style="width: @(progressPercent)%;"></div>
    }
    
    <!-- Job Notes Indicator -->
    @if (Model.JobNotes?.Any() == true)
    {
        var hasHighPriorityNotes = Model.JobNotes.Any(n => n.Priority <= 2 && !n.IsCompleted);
        var noteCount = Model.JobNotes.Count(n => !n.IsCompleted);
        
        @if (hasHighPriorityNotes)
        {
            <div class="absolute top-1 right-1 w-3 h-3 bg-red-500 rounded-full border border-white shadow-sm" 
                 title="@noteCount urgent note@(noteCount != 1 ? "s" : "")"></div>
        }
        else if (noteCount > 0)
        {
            <div class="absolute top-1 right-1 w-3 h-3 bg-blue-500 rounded-full border border-white shadow-sm flex items-center justify-center text-xs text-white" 
                 title="@noteCount note@(noteCount != 1 ? "s" : "")">@(noteCount > 9 ? "9+" : noteCount.ToString())</div>
        }
    }
    
    <!-- Multi-Stage Indicator -->
    @if (Model.JobStages?.Any() == true)
    {
        var completedStages = Model.JobStages.Count(s => s.Status == "Completed");
        var totalStages = Model.JobStages.Count;
        
        <div class="absolute bottom-1 left-1 text-xs bg-black bg-opacity-50 text-white px-1 rounded" 
             title="Multi-stage job: @completedStages/@totalStages stages completed">
            @completedStages/@totalStages
        </div>
    }
</div>

<style>
    /* Override default job block styles for enhanced version */
    .job-block .priority-indicator {
        font-size: 10px;
        margin-right: 2px;
        filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.3));
    }
    
    .job-block .rush-indicator {
        font-size: 10px;
        margin-left: 2px;
        filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.3));
    }
    
    .job-block .material-info {
        font-style: italic;
        opacity: 0.9;
    }
    
    .job-block .duration-info,
    .job-block .quantity-info {
        font-size: 9px;
        font-weight: 500;
    }
    
    /* Enhanced hover effects */
    .job-block:hover .job-block-content {
        transform: scale(1.02);
    }
    
    .job-block:hover .job-progress-bar {
        box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
    }
</style>