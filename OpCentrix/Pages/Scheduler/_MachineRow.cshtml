@* _MachineRow.cshtml *@
@model OpCentrix.Models.MachineViewModel

@{
    var start = ViewData["StartOfWeek"] as DateTime? ?? DateTime.Today;
    int current = 0;
    var jobs = Model.Jobs.OrderBy(j => j.StartDate).ToList();
}
<div class="grid grid-cols-7 gap-1">
    @foreach (var job in jobs)
    {
        var index = (job.StartDate.Date - start.Date).Days;
        if (index > current)
        {
            for (int i = current; i < index && i < 7; i++)
            {
                var day = start.AddDays(i);
                <div class="border h-20" hx-get="/Scheduler?handler=ShowAddModal&amp;machine=@Model.Name&amp;date=@day.ToString("yyyy-MM-dd")" hx-target="#modalContainer" hx-swap="innerHTML"></div>
            }
            current = index;
        }
        if (index >= 7) { break; }
        var span = Math.Min(job.DurationDays, 7 - index);
        <div class="border h-20 col-span-@span">
            @await Html.PartialAsync("_JobBlock", job)
        </div>
        current = index + span;
    }
    @for (int i = current; i < 7; i++)
    {
        var day = start.AddDays(i);
        <div class="border h-20" hx-get="/Scheduler?handler=ShowAddModal&amp;machine=@Model.Name&amp;date=@day.ToString("yyyy-MM-dd")" hx-target="#modalContainer" hx-swap="innerHTML"></div>
    }
</div>
