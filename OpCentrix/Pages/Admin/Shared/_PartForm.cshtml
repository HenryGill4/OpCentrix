@model OpCentrix.Models.Part

<form method="post" id="partForm">
    <input type="hidden" asp-for="Id" />
    
    <!-- Tab Navigation -->
    <ul class="nav nav-tabs" id="partFormTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">
                <i class="fas fa-info-circle me-2"></i>Basic Info
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="material-tab" data-bs-toggle="tab" data-bs-target="#material" type="button" role="tab">
                <i class="fas fa-flask me-2"></i>Material & Process
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="physical-tab" data-bs-toggle="tab" data-bs-target="#physical" type="button" role="tab">
                <i class="fas fa-cube me-2"></i>Physical Properties
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="cost-tab" data-bs-toggle="tab" data-bs-target="#cost" type="button" role="tab">
                <i class="fas fa-dollar-sign me-2"></i>Cost & Timing
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="requirements-tab" data-bs-toggle="tab" data-bs-target="#requirements" type="button" role="tab">
                <i class="fas fa-certificate me-2"></i>Quality & Requirements
            </button>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="partFormTabsContent">
        <!-- Basic Information Tab -->
        <div class="tab-pane fade show active" id="basic" role="tabpanel">
            <div class="row g-3 mt-2">
                <div class="col-md-4">
                    <label asp-for="PartNumber" class="form-label required">Part Number</label>
                    <input asp-for="PartNumber" class="form-control" required />
                    <span asp-validation-for="PartNumber" class="text-danger"></span>
                </div>
                <div class="col-md-8">
                    <label asp-for="Name" class="form-label required">Part Name</label>
                    <input asp-for="Name" class="form-control" required />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>
                <div class="col-12">
                    <label asp-for="Description" class="form-label required">Description</label>
                    <textarea asp-for="Description" class="form-control" rows="3" required></textarea>
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="CustomerPartNumber" class="form-label">Customer Part Number</label>
                    <input asp-for="CustomerPartNumber" class="form-control" />
                    <span asp-validation-for="CustomerPartNumber" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="Industry" class="form-label required">Industry</label>
                    <select asp-for="Industry" class="form-select" required>
                        <option value="">Select Industry</option>
                        <option value="Aerospace">Aerospace</option>
                        <option value="Automotive">Automotive</option>
                        <option value="Medical">Medical</option>
                        <option value="Oil & Gas">Oil & Gas</option>
                        <option value="Defense">Defense</option>
                        <option value="Marine">Marine</option>
                        <option value="General">General</option>
                        <option value="Research">Research</option>
                    </select>
                    <span asp-validation-for="Industry" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="Application" class="form-label required">Application</label>
                    <select asp-for="Application" class="form-select" required>
                        <option value="">Select Application</option>
                        <option value="Prototype">Prototype</option>
                        <option value="Production">Production</option>
                        <option value="Tooling">Tooling</option>
                        <option value="Repair">Repair</option>
                        <option value="Structural Component">Structural Component</option>
                        <option value="Heat Exchanger">Heat Exchanger</option>
                        <option value="Valve Body">Valve Body</option>
                        <option value="Impeller">Impeller</option>
                        <option value="Surgical Instrument">Surgical Instrument</option>
                        <option value="UAV Frame">UAV Frame</option>
                        <option value="General Component">General Component</option>
                    </select>
                    <span asp-validation-for="Application" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="PartCategory" class="form-label">Category</label>
                    <select asp-for="PartCategory" class="form-select">
                        <option value="Prototype">Prototype</option>
                        <option value="Production">Production</option>
                        <option value="Tooling">Tooling</option>
                        <option value="Repair">Repair</option>
                    </select>
                    <span asp-validation-for="PartCategory" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="PartClass" class="form-label">Part Class</label>
                    <select asp-for="PartClass" class="form-select">
                        <option value="A">A - Critical</option>
                        <option value="B">B - Important</option>
                        <option value="C">C - Standard</option>
                    </select>
                    <span asp-validation-for="PartClass" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <div class="form-check mt-4">
                        <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                        <label asp-for="IsActive" class="form-check-label">Active</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Material & Process Tab -->
        <div class="tab-pane fade" id="material" role="tabpanel">
            <div class="row g-3 mt-2">
                <div class="col-md-6">
                    <label asp-for="Material" class="form-label required">Material</label>
                    <select asp-for="Material" class="form-select" id="materialSelect" onchange="safeOnMaterialChange(this.value)" required>
                        <option value="">Select Material</option>
                        <option value="Ti-6Al-4V Grade 5">Ti-6Al-4V Grade 5</option>
                        <option value="Ti-6Al-4V ELI Grade 23">Ti-6Al-4V ELI Grade 23</option>
                        <option value="Inconel 718">Inconel 718</option>
                        <option value="Inconel 625">Inconel 625</option>
                        <option value="316L Stainless Steel">316L Stainless Steel</option>
                        <option value="17-4 PH Stainless Steel">17-4 PH Stainless Steel</option>
                        <option value="AlSi10Mg">AlSi10Mg</option>
                        <option value="CoCrMo">CoCrMo</option>
                    </select>
                    <span asp-validation-for="Material" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="SlsMaterial" class="form-label required">SLS Material</label>
                    <input asp-for="SlsMaterial" class="form-control" required />
                    <span asp-validation-for="SlsMaterial" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="PowderSpecification" class="form-label">Powder Specification</label>
                    <input asp-for="PowderSpecification" class="form-control" placeholder="e.g., 15-45 micron particle size" />
                    <span asp-validation-for="PowderSpecification" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="PowderRequirementKg" class="form-label">Powder Requirement (kg)</label>
                    <input asp-for="PowderRequirementKg" type="number" step="0.1" class="form-control" />
                    <span asp-validation-for="PowderRequirementKg" class="text-danger"></span>
                </div>

                <!-- SLS Process Parameters -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3">
                        <i class="fas fa-cogs me-2"></i>SLS Process Parameters
                    </h6>
                </div>
                <div class="col-md-3">
                    <label asp-for="RecommendedLaserPower" class="form-label">Laser Power (W)</label>
                    <input asp-for="RecommendedLaserPower" type="number" step="1" class="form-control" />
                    <span asp-validation-for="RecommendedLaserPower" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="RecommendedScanSpeed" class="form-label">Scan Speed (mm/s)</label>
                    <input asp-for="RecommendedScanSpeed" type="number" step="10" class="form-control" />
                    <span asp-validation-for="RecommendedScanSpeed" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="RecommendedLayerThickness" class="form-label">Layer Thickness (?m)</label>
                    <input asp-for="RecommendedLayerThickness" type="number" step="1" class="form-control" />
                    <span asp-validation-for="RecommendedLayerThickness" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="RecommendedHatchSpacing" class="form-label">Hatch Spacing (?m)</label>
                    <input asp-for="RecommendedHatchSpacing" type="number" step="1" class="form-control" />
                    <span asp-validation-for="RecommendedHatchSpacing" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="RecommendedBuildTemperature" class="form-label">Build Temperature (°C)</label>
                    <input asp-for="RecommendedBuildTemperature" type="number" step="1" class="form-control" />
                    <span asp-validation-for="RecommendedBuildTemperature" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="RequiredArgonPurity" class="form-label">Argon Purity (%)</label>
                    <input asp-for="RequiredArgonPurity" type="number" step="0.1" min="99" max="100" class="form-control" />
                    <span asp-validation-for="RequiredArgonPurity" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="MaxOxygenContent" class="form-label">Max Oxygen (ppm)</label>
                    <input asp-for="MaxOxygenContent" type="number" step="1" class="form-control" />
                    <span asp-validation-for="MaxOxygenContent" class="text-danger"></span>
                </div>
            </div>
        </div>

        <!-- Physical Properties Tab -->
        <div class="tab-pane fade" id="physical" role="tabpanel">
            <div class="row g-3 mt-2">
                <!-- Dimensions -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3">
                        <i class="fas fa-ruler me-2"></i>Dimensions
                    </h6>
                </div>
                <div class="col-md-3">
                    <label asp-for="LengthMm" class="form-label">Length (mm)</label>
                    <input asp-for="LengthMm" type="number" step="0.1" class="form-control" />
                    <span asp-validation-for="LengthMm" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="WidthMm" class="form-label">Width (mm)</label>
                    <input asp-for="WidthMm" type="number" step="0.1" class="form-control" />
                    <span asp-validation-for="WidthMm" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="HeightMm" class="form-label">Height (mm)</label>
                    <input asp-for="HeightMm" type="number" step="0.1" class="form-control" />
                    <span asp-validation-for="HeightMm" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="WeightGrams" class="form-label">Weight (g)</label>
                    <input asp-for="WeightGrams" type="number" step="0.1" class="form-control" />
                    <span asp-validation-for="WeightGrams" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="VolumeMm3" class="form-label">Volume (mm³)</label>
                    <input asp-for="VolumeMm3" type="number" step="1" class="form-control" />
                    <span asp-validation-for="VolumeMm3" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="Dimensions" class="form-label">Dimensions String</label>
                    <input asp-for="Dimensions" class="form-control" placeholder="e.g., 100 x 50 x 25 mm" />
                    <span asp-validation-for="Dimensions" class="text-danger"></span>
                </div>

                <!-- Surface Finish -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-layer-group me-2"></i>Surface Finish
                    </h6>
                </div>
                <div class="col-md-6">
                    <label asp-for="SurfaceFinishRequirement" class="form-label">Surface Finish Requirement</label>
                    <select asp-for="SurfaceFinishRequirement" class="form-select">
                        <option value="As-built">As-built</option>
                        <option value="Machined">Machined</option>
                        <option value="Polished">Polished</option>
                        <option value="Sandblasted">Sandblasted</option>
                        <option value="Coated">Coated</option>
                    </select>
                    <span asp-validation-for="SurfaceFinishRequirement" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="MaxSurfaceRoughnessRa" class="form-label">Max Surface Roughness Ra (?m)</label>
                    <input asp-for="MaxSurfaceRoughnessRa" type="number" step="0.1" class="form-control" />
                    <span asp-validation-for="MaxSurfaceRoughnessRa" class="text-danger"></span>
                </div>

                <!-- Support Requirements -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-hand-holding-up me-2"></i>Support Requirements
                    </h6>
                </div>
                <div class="col-md-4">
                    <div class="form-check">
                        <input asp-for="RequiresSupports" class="form-check-input" type="checkbox" />
                        <label asp-for="RequiresSupports" class="form-check-label">Requires Supports</label>
                    </div>
                </div>
                <div class="col-md-4">
                    <label asp-for="SupportStrategy" class="form-label">Support Strategy</label>
                    <input asp-for="SupportStrategy" class="form-control" placeholder="e.g., Minimal supports on overhangs > 45°" />
                    <span asp-validation-for="SupportStrategy" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="SupportRemovalTimeMinutes" class="form-label">Support Removal Time (min)</label>
                    <input asp-for="SupportRemovalTimeMinutes" type="number" step="1" class="form-control" />
                    <span asp-validation-for="SupportRemovalTimeMinutes" class="text-danger"></span>
                </div>
            </div>
        </div>

        <!-- Cost & Timing Tab -->
        <div class="tab-pane fade" id="cost" role="tabpanel">
            <div class="row g-3 mt-2">
                <!-- Duration Management -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3">
                        <i class="fas fa-clock me-2"></i>Duration Management
                    </h6>
                </div>
                <div class="col-md-6">
                    <label asp-for="EstimatedHours" class="form-label required">Standard Estimated Hours</label>
                    <input asp-for="EstimatedHours" type="number" step="0.1" min="0.1" class="form-control" required />
                    <span asp-validation-for="EstimatedHours" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="AdminEstimatedHoursOverride" class="form-label">Admin Override Hours</label>
                    <input asp-for="AdminEstimatedHoursOverride" type="number" step="0.1" min="0.1" class="form-control" />
                    <span asp-validation-for="AdminEstimatedHoursOverride" class="text-danger"></span>
                    <div class="form-text">Leave blank to use standard estimated hours</div>
                </div>
                <div class="col-12">
                    <label asp-for="AdminOverrideReason" class="form-label">Admin Override Reason</label>
                    <textarea asp-for="AdminOverrideReason" class="form-control" rows="2" placeholder="Explain why the standard duration was overridden..."></textarea>
                    <span asp-validation-for="AdminOverrideReason" class="text-danger"></span>
                </div>

                <!-- Process Times -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-stopwatch me-2"></i>Process Times (Minutes)
                    </h6>
                </div>
                <div class="col-md-3">
                    <label asp-for="SetupTimeMinutes" class="form-label">Setup Time</label>
                    <input asp-for="SetupTimeMinutes" type="number" step="1" class="form-control" />
                    <span asp-validation-for="SetupTimeMinutes" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="PowderChangeoverTimeMinutes" class="form-label">Powder Changeover</label>
                    <input asp-for="PowderChangeoverTimeMinutes" type="number" step="1" class="form-control" />
                    <span asp-validation-for="PowderChangeoverTimeMinutes" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="PreheatingTimeMinutes" class="form-label">Preheating</label>
                    <input asp-for="PreheatingTimeMinutes" type="number" step="1" class="form-control" />
                    <span asp-validation-for="PreheatingTimeMinutes" class="text-danger"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="CoolingTimeMinutes" class="form-label">Cooling</label>
                    <input asp-for="CoolingTimeMinutes" type="number" step="1" class="form-control" />
                    <span asp-validation-for="CoolingTimeMinutes" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="PostProcessingTimeMinutes" class="form-label">Post-Processing Time</label>
                    <input asp-for="PostProcessingTimeMinutes" type="number" step="1" class="form-control" />
                    <span asp-validation-for="PostProcessingTimeMinutes" class="text-danger"></span>
                </div>

                <!-- Cost Data -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-dollar-sign me-2"></i>Cost Data
                    </h6>
                </div>
                <div class="col-md-4">
                    <label asp-for="MaterialCostPerKg" class="form-label">Material Cost ($/kg)</label>
                    <input asp-for="MaterialCostPerKg" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="MaterialCostPerKg" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="StandardLaborCostPerHour" class="form-label">Labor Cost ($/hr)</label>
                    <input asp-for="StandardLaborCostPerHour" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="StandardLaborCostPerHour" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="MachineOperatingCostPerHour" class="form-label">Machine Cost ($/hr)</label>
                    <input asp-for="MachineOperatingCostPerHour" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="MachineOperatingCostPerHour" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="SetupCost" class="form-label">Setup Cost ($)</label>
                    <input asp-for="SetupCost" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="SetupCost" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="PostProcessingCost" class="form-label">Post-Processing ($)</label>
                    <input asp-for="PostProcessingCost" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="PostProcessingCost" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="QualityInspectionCost" class="form-label">Quality Inspection ($)</label>
                    <input asp-for="QualityInspectionCost" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="QualityInspectionCost" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="ArgonCostPerHour" class="form-label">Argon Cost ($/hr)</label>
                    <input asp-for="ArgonCostPerHour" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="ArgonCostPerHour" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="StandardSellingPrice" class="form-label">Standard Selling Price ($)</label>
                    <input asp-for="StandardSellingPrice" type="number" step="0.01" class="form-control" />
                    <span asp-validation-for="StandardSellingPrice" class="text-danger"></span>
                </div>
            </div>
        </div>

        <!-- Quality & Requirements Tab -->
        <div class="tab-pane fade" id="requirements" role="tabpanel">
            <div class="row g-3 mt-2">
                <!-- Quality Standards -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3">
                        <i class="fas fa-award me-2"></i>Quality Standards
                    </h6>
                </div>
                <div class="col-md-6">
                    <label asp-for="QualityStandards" class="form-label">Quality Standards</label>
                    <textarea asp-for="QualityStandards" class="form-control" rows="2" placeholder="e.g., ASTM F3001, ISO 17296"></textarea>
                    <span asp-validation-for="QualityStandards" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="ToleranceRequirements" class="form-label">Tolerance Requirements</label>
                    <textarea asp-for="ToleranceRequirements" class="form-control" rows="2" placeholder="e.g., ±0.1mm typical, ±0.05mm critical dimensions"></textarea>
                    <span asp-validation-for="ToleranceRequirements" class="text-danger"></span>
                </div>

                <!-- Certifications -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-certificate me-2"></i>Required Certifications
                    </h6>
                </div>
                <div class="col-md-3">
                    <div class="form-check">
                        <input asp-for="RequiresInspection" class="form-check-input" type="checkbox" />
                        <label asp-for="RequiresInspection" class="form-check-label">Requires Inspection</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check">
                        <input asp-for="RequiresCertification" class="form-check-input" type="checkbox" />
                        <label asp-for="RequiresCertification" class="form-check-label">Requires Certification</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check">
                        <input asp-for="RequiresFDA" class="form-check-input" type="checkbox" />
                        <label asp-for="RequiresFDA" class="form-check-label">Requires FDA</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check">
                        <input asp-for="RequiresAS9100" class="form-check-input" type="checkbox" />
                        <label asp-for="RequiresAS9100" class="form-check-label">Requires AS9100</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-check">
                        <input asp-for="RequiresNADCAP" class="form-check-input" type="checkbox" />
                        <label asp-for="RequiresNADCAP" class="form-check-label">Requires NADCAP</label>
                    </div>
                </div>

                <!-- Requirements -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-tools me-2"></i>Manufacturing Requirements
                    </h6>
                </div>
                <div class="col-md-6">
                    <label asp-for="ProcessType" class="form-label">Process Type</label>
                    <select asp-for="ProcessType" class="form-select">
                        <option value="SLS Metal">SLS Metal</option>
                        <option value="SLS Polymer">SLS Polymer</option>
                        <option value="DMLS">DMLS</option>
                        <option value="EBM">EBM</option>
                    </select>
                    <span asp-validation-for="ProcessType" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="RequiredMachineType" class="form-label">Required Machine Type</label>
                    <input asp-for="RequiredMachineType" class="form-control" placeholder="e.g., TruPrint 3000" />
                    <span asp-validation-for="RequiredMachineType" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="PreferredMachines" class="form-label">Preferred Machines</label>
                    <input asp-for="PreferredMachines" class="form-control" placeholder="Comma-separated list, e.g., TI1,TI2" />
                    <span asp-validation-for="PreferredMachines" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="RequiredSkills" class="form-label">Required Skills</label>
                    <textarea asp-for="RequiredSkills" class="form-control" rows="2" placeholder="e.g., SLS Operation, Powder Handling, Post-Processing"></textarea>
                    <span asp-validation-for="RequiredSkills" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="RequiredCertifications" class="form-label">Required Certifications</label>
                    <textarea asp-for="RequiredCertifications" class="form-control" rows="2" placeholder="e.g., SLS Operation Certification, Powder Safety Training"></textarea>
                    <span asp-validation-for="RequiredCertifications" class="text-danger"></span>
                </div>
                <div class="col-md-6">
                    <label asp-for="RequiredTooling" class="form-label">Required Tooling</label>
                    <textarea asp-for="RequiredTooling" class="form-control" rows="2" placeholder="e.g., Build Platform, Powder Sieve, Support Removal Tools"></textarea>
                    <span asp-validation-for="RequiredTooling" class="text-danger"></span>
                </div>
                <div class="col-12">
                    <label asp-for="ConsumableMaterials" class="form-label">Consumable Materials</label>
                    <textarea asp-for="ConsumableMaterials" class="form-control" rows="2" placeholder="e.g., Argon Gas, Build Platform Coating"></textarea>
                    <span asp-validation-for="ConsumableMaterials" class="text-danger"></span>
                </div>

                <!-- File Information -->
                <div class="col-12">
                    <h6 class="border-bottom pb-2 mb-3 mt-4">
                        <i class="fas fa-file me-2"></i>File Information
                    </h6>
                </div>
                <div class="col-md-4">
                    <label asp-for="BuildFileTemplate" class="form-label">Build File Template</label>
                    <input asp-for="BuildFileTemplate" class="form-control" placeholder="Template .slm file path" />
                    <span asp-validation-for="BuildFileTemplate" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="CadFilePath" class="form-label">CAD File Path</label>
                    <input asp-for="CadFilePath" class="form-control" placeholder="Original CAD file path" />
                    <span asp-validation-for="CadFilePath" class="text-danger"></span>
                </div>
                <div class="col-md-4">
                    <label asp-for="CadFileVersion" class="form-label">CAD File Version</label>
                    <input asp-for="CadFileVersion" class="form-control" placeholder="e.g., v1.2" />
                    <span asp-validation-for="CadFileVersion" class="text-danger"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Footer -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Save Part
                </button>
            </div>
        </div>
    </div>
</form>

<script>
    // Material auto-fill data
    const MATERIAL_DEFAULTS = {
        'Ti-6Al-4V Grade 5': {
            slsMaterial: 'Ti-6Al-4V Grade 5',
            laserPower: 200,
            scanSpeed: 1200,
            layerThickness: 30,
            hatchSpacing: 120,
            buildTemperature: 180,
            argonPurity: 99.9,
            oxygenContent: 50,
            materialCost: 450.00,
            laborCost: 85.00,
            machineOperatingCost: 125.00,
            estimatedHours: 8.0
        },
        'Ti-6Al-4V ELI Grade 23': {
            slsMaterial: 'Ti-6Al-4V ELI Grade 23',
            laserPower: 180,
            scanSpeed: 1450,
            layerThickness: 30,
            hatchSpacing: 120,
            buildTemperature: 165,
            argonPurity: 99.95,
            oxygenContent: 30,
            materialCost: 550.00,
            laborCost: 85.00,
            machineOperatingCost: 125.00,
            estimatedHours: 8.5
        },
        'Inconel 718': {
            slsMaterial: 'Inconel 718',
            laserPower: 285,
            scanSpeed: 960,
            layerThickness: 40,
            hatchSpacing: 110,
            buildTemperature: 200,
            argonPurity: 99.9,
            oxygenContent: 50,
            materialCost: 750.00,
            laborCost: 95.00,
            machineOperatingCost: 135.00,
            estimatedHours: 12.0
        },
        'Inconel 625': {
            slsMaterial: 'Inconel 625',
            laserPower: 275,
            scanSpeed: 980,
            layerThickness: 40,
            hatchSpacing: 110,
            buildTemperature: 195,
            argonPurity: 99.9,
            oxygenContent: 30,
            materialCost: 800.00,
            laborCost: 95.00,
            machineOperatingCost: 135.00,
            estimatedHours: 12.5
        },
        '316L Stainless Steel': {
            slsMaterial: '316L Stainless Steel',
            laserPower: 200,
            scanSpeed: 1150,
            layerThickness: 30,
            hatchSpacing: 120,
            buildTemperature: 170,
            argonPurity: 99.5,
            oxygenContent: 100,
            materialCost: 150.00,
            laborCost: 75.00,
            machineOperatingCost: 115.00,
            estimatedHours: 6.0
        },
        '17-4 PH Stainless Steel': {
            slsMaterial: '17-4 PH Stainless Steel',
            laserPower: 195,
            scanSpeed: 1250,
            layerThickness: 30,
            hatchSpacing: 120,
            buildTemperature: 165,
            argonPurity: 99.5,
            oxygenContent: 100,
            materialCost: 180.00,
            laborCost: 80.00,
            machineOperatingCost: 120.00,
            estimatedHours: 7.0
        },
        'AlSi10Mg': {
            slsMaterial: 'AlSi10Mg',
            laserPower: 175,
            scanSpeed: 1350,
            layerThickness: 30,
            hatchSpacing: 130,
            buildTemperature: 160,
            argonPurity: 99.5,
            oxygenContent: 100,
            materialCost: 80.00,
            laborCost: 70.00,
            machineOperatingCost: 100.00,
            estimatedHours: 5.0
        },
        'CoCrMo': {
            slsMaterial: 'CoCrMo',
            laserPower: 220,
            scanSpeed: 1100,
            layerThickness: 30,
            hatchSpacing: 115,
            buildTemperature: 175,
            argonPurity: 99.8,
            oxygenContent: 50,
            materialCost: 650.00,
            laborCost: 90.00,
            machineOperatingCost: 130.00,
            estimatedHours: 10.0
        }
    };

    // Global function for material change
    window.onMaterialChange = function(selectedMaterial) {
        const defaults = MATERIAL_DEFAULTS[selectedMaterial];
        if (!defaults) return;

        // Update form fields with material defaults
        const fieldMappings = {
            'Part.SlsMaterial': defaults.slsMaterial,
            'Part.RecommendedLaserPower': defaults.laserPower,
            'Part.RecommendedScanSpeed': defaults.scanSpeed,
            'Part.RecommendedLayerThickness': defaults.layerThickness,
            'Part.RecommendedHatchSpacing': defaults.hatchSpacing,
            'Part.RecommendedBuildTemperature': defaults.buildTemperature,
            'Part.RequiredArgonPurity': defaults.argonPurity,
            'Part.MaxOxygenContent': defaults.oxygenContent,
            'Part.MaterialCostPerKg': defaults.materialCost,
            'Part.StandardLaborCostPerHour': defaults.laborCost,
            'Part.MachineOperatingCostPerHour': defaults.machineOperatingCost,
            'Part.EstimatedHours': defaults.estimatedHours
        };

        Object.keys(fieldMappings).forEach(fieldName => {
            const field = document.querySelector(`[name="${fieldName}"]`);
            if (field && !field.value) { // Only set if field is empty
                field.value = fieldMappings[fieldName];
            }
        });
    };

    // Safe wrapper for material change
    window.safeOnMaterialChange = function(selectedMaterial) {
        try {
            console.log('?? [PARTFORM] Safe material change called:', selectedMaterial);
            if (window.onMaterialChange) {
                window.onMaterialChange(selectedMaterial);
                console.log('? [PARTFORM] Material change completed');
            } else {
                console.warn('?? [PARTFORM] onMaterialChange function not available');
            }
        } catch (error) {
            console.error('? [PARTFORM] Error in material change:', error);
        }
    };

    // Initialize form validation
    document.addEventListener('DOMContentLoaded', function() {
        // Add validation styles
        const style = document.createElement('style');
        style.textContent = `
            .required::after {
                content: ' *';
                color: red;
            }
        `;
        document.head.appendChild(style);
    });
</script>