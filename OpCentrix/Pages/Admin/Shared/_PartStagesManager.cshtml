@model OpCentrix.Models.Part

<!-- Enhanced Manufacturing Stages Manager with Duration Inputs -->
<div class="row g-3">
    <div class="col-12">
        <h6 class="text-primary border-bottom pb-2 mb-3">
            <i class="fas fa-industry me-2"></i>Manufacturing Stages Assignment
        </h6>
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Select Required Stages:</strong> Click the stage buttons below to assign manufacturing stages to this part. Selected stages will be highlighted in green and allow you to configure duration and cost parameters.
        </div>
    </div>
    
    <!-- Available Production Stages Grid -->
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-light">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>Available Manufacturing Stages
                    </h6>
                    <span class="badge bg-primary" id="selectedCount">0 selected</span>
                </div>
            </div>
            <div class="card-body">
                <div id="stageButtonsContainer">
                    <!-- Stage buttons will be loaded here -->
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading stages...</span>
                        </div>
                        <p class="text-muted mt-2">Loading available stages...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Selected Stages Configuration -->
    <div class="col-12" id="selectedStagesConfiguration" style="display: none;">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0">
                    <i class="fas fa-cogs me-2"></i>Stage Configuration & Duration
                </h6>
            </div>
            <div class="card-body">
                <div id="selectedStagesList" class="row g-3">
                    <!-- Selected stages configuration will appear here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Manufacturing Summary -->
    <div class="col-12" id="selectedStagesSummary" style="display: none;">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                    <i class="fas fa-chart-line me-2"></i>Manufacturing Summary
                </h6>
            </div>
            <div class="card-body">
                <!-- Quick Summary -->
                <div class="row text-center">
                    <div class="col-3">
                        <div class="h5 text-primary mb-0" id="summaryStageCount">0</div>
                        <small class="text-muted">Stages</small>
                    </div>
                    <div class="col-3">
                        <div class="h5 text-info mb-0" id="summaryTotalHours">0.0h</div>
                        <small class="text-muted">Total Duration</small>
                    </div>
                    <div class="col-3">
                        <div class="h5 text-success mb-0" id="summaryTotalCost">$0</div>
                        <small class="text-muted">Est. Cost</small>
                    </div>
                    <div class="col-3">
                        <div class="h5 text-warning mb-0" id="summaryComplexity">Simple</div>
                        <small class="text-muted">Complexity</small>
                    </div>
                </div>
                
                <!-- Detailed breakdown -->
                <div class="mt-3 p-3 bg-light rounded">
                    <h6 class="mb-2">Stage Execution Order:</h6>
                    <div id="stageExecutionOrder" class="d-flex flex-wrap gap-2">
                        <!-- Stage order will be shown here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Instructions -->
    <div class="col-12">
        <div class="alert alert-success d-none" id="completionHint">
            <i class="fas fa-thumbs-up me-2"></i>
            <strong>Great!</strong> You have configured <span id="configuredStageCount">0</span> manufacturing stages for this part. All stages have duration and cost information.
        </div>
        <div class="alert alert-light" id="instructionHint">
            <i class="fas fa-hand-pointer me-2"></i>
            <strong>Tip:</strong> Manufacturing stages are optional. You can proceed without selecting any stages if they will be determined later in the production process.
        </div>
    </div>
</div>

<!-- Hidden inputs for form submission -->
<div id="stageInputsContainer">
    <!-- Stage requirement inputs will be generated here -->
</div>

<!-- JavaScript for Enhanced Stage Management -->
<script>
(function() {
    'use strict';
    
    console.log('?? [STAGES] Enhanced stage manager with duration inputs initializing...');
    
    // State management
    let selectedStages = new Set();
    let availableStages = [];
    let stageData = new Map();
    
    // Initialize when ready
    document.addEventListener('DOMContentLoaded', function() {
        initializeEnhancedStageManager();
    });
    
    async function initializeEnhancedStageManager() {
        try {
            console.log('?? [STAGES] Loading enhanced stage manager...');
            await loadAvailableStages();
            await loadExistingSelections();
            renderStageButtons();
            updateUI();
            console.log('? [STAGES] Enhanced stage manager loaded successfully');
        } catch (error) {
            console.error('? [STAGES] Error initializing stage manager:', error);
            showErrorState();
        }
    }
    
    async function loadAvailableStages() {
        try {
            // Try to get stages from the server
            const response = await fetch('/Admin/ProductionStages/Index?handler=GetAvailableStages', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                availableStages = data || [];
            } else {
                console.warn('?? [STAGES] Could not load stages from server, using defaults');
                availableStages = getDefaultStages();
            }
            
            // Ensure we have stages
            if (availableStages.length === 0) {
                availableStages = getDefaultStages();
            }
            
            console.log(`?? [STAGES] Loaded ${availableStages.length} available stages`);
        } catch (error) {
            console.warn('?? [STAGES] Failed to load stages from server, using defaults:', error);
            availableStages = getDefaultStages();
        }
    }
    
    async function loadExistingSelections() {
        try {
            const partId = document.querySelector('input[name="Part.Id"]')?.value;
            if (partId && partId !== '0') {
                console.log(`?? [STAGES] Loading existing stages for part ${partId}`);
                
                // Check for existing stage data in form
                const existingStageInputs = document.querySelectorAll('input[name^="SelectedStageIds"]');
                existingStageInputs.forEach((input, index) => {
                    const stageId = parseInt(input.value);
                    if (stageId > 0) {
                        selectedStages.add(stageId);
                        
                        // Load associated data
                        const executionOrder = document.querySelector(`input[name="StageExecutionOrders[${index}]"]`)?.value || (index + 1);
                        const estimatedHours = document.querySelector(`input[name="StageEstimatedHours[${index}]"]`)?.value || 1.0;
                        const hourlyRate = document.querySelector(`input[name="StageHourlyRates[${index}]"]`)?.value || 85.00;
                        const materialCost = document.querySelector(`input[name="StageMaterialCosts[${index}]"]`)?.value || 0;
                        
                        const stage = availableStages.find(s => s.id === stageId);
                        if (stage) {
                            stageData.set(stageId, {
                                id: stageId,
                                name: stage.name,
                                executionOrder: parseInt(executionOrder),
                                estimatedHours: parseFloat(estimatedHours),
                                hourlyRate: parseFloat(hourlyRate),
                                materialCost: parseFloat(materialCost),
                                isRequired: true
                            });
                        }
                    }
                });
                
                console.log(`?? [STAGES] Loaded ${selectedStages.size} existing stage assignments`);
            }
        } catch (error) {
            console.warn('?? [STAGES] Could not load existing stage assignments:', error);
        }
    }
    
    function getDefaultStages() {
        return [
            {
                id: 1,
                name: '3D Printing (SLS)',
                description: 'Selective Laser Sintering metal printing',
                stageColor: '#007bff',
                stageIcon: 'fas fa-print',
                department: '3D Printing',
                defaultDurationHours: 8.0,
                defaultHourlyRate: 85.00,
                defaultMaterialCost: 25.00,
                displayOrder: 1
            },
            {
                id: 2,
                name: 'CNC Machining',
                description: 'Computer Numerical Control machining',
                stageColor: '#28a745',
                stageIcon: 'fas fa-cogs',
                department: 'CNC Machining',
                defaultDurationHours: 4.0,
                defaultHourlyRate: 95.00,
                defaultMaterialCost: 10.00,
                displayOrder: 2
            },
            {
                id: 3,
                name: 'EDM Operations',
                description: 'Electrical Discharge Machining',
                stageColor: '#ffc107',
                stageIcon: 'fas fa-bolt',
                department: 'EDM',
                defaultDurationHours: 6.0,
                defaultHourlyRate: 120.00,
                defaultMaterialCost: 15.00,
                displayOrder: 3
            },
            {
                id: 4,
                name: 'Laser Engraving',
                description: 'Laser engraving and marking',
                stageColor: '#fd7e14',
                stageIcon: 'fas fa-crosshairs',
                department: 'Laser Operations',
                defaultDurationHours: 0.5,
                defaultHourlyRate: 75.00,
                defaultMaterialCost: 1.00,
                displayOrder: 4
            },
            {
                id: 5,
                name: 'Sandblasting',
                description: 'Surface preparation and finishing',
                stageColor: '#6c757d',
                stageIcon: 'fas fa-spray-can',
                department: 'Finishing',
                defaultDurationHours: 3.0,
                defaultHourlyRate: 65.00,
                defaultMaterialCost: 8.00,
                displayOrder: 5
            },
            {
                id: 6,
                name: 'Coating/Cerakote',
                description: 'Surface treatment and coating',
                stageColor: '#6f42c1',
                stageIcon: 'fas fa-paint-brush',
                department: 'Finishing',
                defaultDurationHours: 3.0,
                defaultHourlyRate: 70.00,
                defaultMaterialCost: 8.00,
                displayOrder: 6
            },
            {
                id: 7,
                name: 'Assembly',
                description: 'Final assembly operations',
                stageColor: '#17a2b8',
                stageIcon: 'fas fa-puzzle-piece',
                department: 'Assembly',
                defaultDurationHours: 2.0,
                defaultHourlyRate: 80.00,
                defaultMaterialCost: 5.00,
                displayOrder: 7
            },
            {
                id: 8,
                name: 'Quality Inspection',
                description: 'Final quality control and testing',
                stageColor: '#dc3545',
                stageIcon: 'fas fa-search',
                department: 'Quality Control',
                defaultDurationHours: 1.0,
                defaultHourlyRate: 80.00,
                defaultMaterialCost: 2.00,
                displayOrder: 8
            }
        ];
    }
    
    function renderStageButtons() {
        const container = document.getElementById('stageButtonsContainer');
        if (!container) return;
        
        if (availableStages.length === 0) {
            container.innerHTML = `
                <div class="text-center py-4 text-muted">
                    <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                    <h6>No Production Stages Available</h6>
                    <p>Please configure production stages in the admin panel first.</p>
                    <a href="/Admin/ProductionStages" class="btn btn-outline-primary" target="_blank">
                        <i class="fas fa-external-link-alt me-1"></i>Configure Stages
                    </a>
                </div>
            `;
            return;
        }
        
        const sortedStages = availableStages.sort((a, b) => (a.displayOrder || 0) - (b.displayOrder || 0));
        
        const buttonsHtml = `
            <div class="row g-3">
                ${sortedStages.map(stage => {
                    const isSelected = selectedStages.has(stage.id);
                    const buttonClass = isSelected ? 'btn-success' : 'btn-outline-secondary';
                    const iconClass = isSelected ? 'fas fa-check-circle' : stage.stageIcon || 'fas fa-cogs';
                    
                    return `
                        <div class="col-md-6 col-lg-4">
                            <button type="button" 
                                    class="btn ${buttonClass} w-100 stage-selection-btn" 
                                    data-stage-id="${stage.id}"
                                    onclick="toggleStage(${stage.id})"
                                    title="${stage.description || stage.name}"
                                    style="min-height: 120px; transition: all 0.3s ease; border: 2px solid transparent;">
                                <div class="d-flex flex-column align-items-center justify-content-center p-2">
                                    <div class="text-center mb-2">
                                        <i class="${iconClass} fa-2x" style="color: ${isSelected ? '#fff' : stage.stageColor};"></i>
                                    </div>
                                    <div class="text-center">
                                        <strong class="d-block">${stage.name}</strong>
                                        ${stage.department ? `<small class="d-block opacity-75">${stage.department}</small>` : ''}
                                        <small class="d-block opacity-75">
                                            <i class="fas fa-clock me-1"></i>~${stage.defaultDurationHours || 1}h
                                            • $${(stage.defaultHourlyRate || 85).toFixed(0)}/hr
                                        </small>
                                    </div>
                                    <div class="mt-2">
                                        <i class="${isSelected ? 'fas fa-check' : 'fas fa-plus'} fa-lg"></i>
                                    </div>
                                </div>
                            </button>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
        
        container.innerHTML = buttonsHtml;
        
        // Apply hover effects
        container.querySelectorAll('.stage-selection-btn').forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                if (!this.classList.contains('btn-success')) {
                    this.style.transform = 'translateY(-2px)';
                    this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
                    this.style.backgroundColor = '#f8f9fa';
                    this.style.borderColor = '#007bff';
                    this.style.color = '#007bff';
                }
            });
            
            btn.addEventListener('mouseleave', function() {
                if (!this.classList.contains('btn-success')) {
                    this.style.transform = '';
                    this.style.boxShadow = '';
                    this.style.backgroundColor = '';
                    this.style.borderColor = '';
                    this.style.color = '';
                }
            });
        });
    }
    
    // Global function for toggling stages
    window.toggleStage = function(stageId) {
        try {
            console.log(`?? [STAGES] Toggling stage ${stageId}`);
            
            const stage = availableStages.find(s => s.id === stageId);
            if (!stage) {
                console.error(`? [STAGES] Stage ${stageId} not found`);
                return;
            }
            
            if (selectedStages.has(stageId)) {
                selectedStages.delete(stageId);
                stageData.delete(stageId);
                console.log(`? [STAGES] Removed stage: ${stage.name}`);
            } else {
                selectedStages.add(stageId);
                stageData.set(stageId, {
                    id: stageId,
                    name: stage.name,
                    executionOrder: selectedStages.size,
                    estimatedHours: stage.defaultDurationHours || 1.0,
                    hourlyRate: stage.defaultHourlyRate || 85.00,
                    materialCost: stage.defaultMaterialCost || 0,
                    isRequired: true
                });
                console.log(`? [STAGES] Added stage: ${stage.name}`);
            }
            
            renderStageButtons();
            updateUI();
            generateHiddenInputs();
            notifyWizard();
            
        } catch (error) {
            console.error('? [STAGES] Error toggling stage:', error);
        }
    };
    
    function updateUI() {
        updateSelectedCount();
        updateSelectedStagesConfiguration();
        updateSelectedStagesSummary();
        updateHints();
        updateSummaryCalculations();
    }
    
    function updateSelectedCount() {
        const countElement = document.getElementById('selectedCount');
        if (countElement) {
            const count = selectedStages.size;
            countElement.textContent = count === 0 ? '0 selected' : 
                count === 1 ? '1 selected' : `${count} selected`;
        }
    }
    
    function updateSelectedStagesConfiguration() {
        const configContainer = document.getElementById('selectedStagesConfiguration');
        const stagesList = document.getElementById('selectedStagesList');
        
        if (!configContainer || !stagesList) return;
        
        if (selectedStages.size === 0) {
            configContainer.style.display = 'none';
            return;
        }
        
        configContainer.style.display = 'block';
        
        const selectedStageArray = Array.from(selectedStages).map(stageId => {
            const stage = availableStages.find(s => s.id === stageId);
            const data = stageData.get(stageId);
            return { stage, data };
        }).filter(item => item.stage && item.data);
        
        const configHtml = selectedStageArray.map(({ stage, data }) => `
            <div class="col-md-6">
                <div class="card border-success" style="border-width: 2px;">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <i class="${stage.stageIcon || 'fas fa-cogs'} me-2" style="color: ${stage.stageColor};"></i>
                            <strong>${stage.name}</strong>
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-danger" 
                                onclick="toggleStage(${stage.id})" title="Remove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label small">Execution Order</label>
                                <input type="number" class="form-control form-control-sm" 
                                       value="${data.executionOrder}" min="1" max="20"
                                       onchange="updateStageProperty(${stage.id}, 'executionOrder', parseInt(this.value))">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Duration (hours)</label>
                                <input type="number" class="form-control form-control-sm" 
                                       value="${data.estimatedHours}" min="0.1" step="0.1"
                                       onchange="updateStageProperty(${stage.id}, 'estimatedHours', parseFloat(this.value))">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Hourly Rate ($)</label>
                                <input type="number" class="form-control form-control-sm" 
                                       value="${data.hourlyRate}" min="0" step="0.01"
                                       onchange="updateStageProperty(${stage.id}, 'hourlyRate', parseFloat(this.value))">
                            </div>
                            <div class="col-6">
                                <label class="form-label small">Material Cost ($)</label>
                                <input type="number" class="form-control form-control-sm" 
                                       value="${data.materialCost}" min="0" step="0.01"
                                       onchange="updateStageProperty(${stage.id}, 'materialCost', parseFloat(this.value))">
                            </div>
                        </div>
                        <div class="mt-2 text-center">
                            <small class="text-muted">
                                Est. Cost: <strong>$${calculateStageCost(data).toFixed(2)}</strong>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
        
        stagesList.innerHTML = configHtml;
    }
    
    // Global function for updating stage properties
    window.updateStageProperty = function(stageId, property, value) {
        const data = stageData.get(stageId);
        if (data) {
            data[property] = value;
            stageData.set(stageId, data);
            updateUI();
            generateHiddenInputs();
            notifyWizard();
        }
    };
    
    function calculateStageCost(data) {
        return (data.estimatedHours * data.hourlyRate) + data.materialCost;
    }
    
    function updateSelectedStagesSummary() {
        const summaryContainer = document.getElementById('selectedStagesSummary');
        if (!summaryContainer) return;
        
        if (selectedStages.size === 0) {
            summaryContainer.style.display = 'none';
            return;
        }
        
        summaryContainer.style.display = 'block';
    }
    
    function updateHints() {
        const completionHint = document.getElementById('completionHint');
        const instructionHint = document.getElementById('instructionHint');
        const configuredStageCount = document.getElementById('configuredStageCount');
        
        if (selectedStages.size > 0) {
            if (completionHint) {
                completionHint.classList.remove('d-none');
                completionHint.classList.add('d-block');
            }
            if (configuredStageCount) {
                configuredStageCount.textContent = selectedStages.size;
            }
            if (instructionHint) {
                instructionHint.style.display = 'none';
            }
        } else {
            if (completionHint) {
                completionHint.classList.remove('d-block');
                completionHint.classList.add('d-none');
            }
            if (instructionHint) {
                instructionHint.style.display = 'block';
            }
        }
    }
    
    function updateSummaryCalculations() {
        let totalHours = 0;
        let totalCost = 0;
        let complexity = 'Simple';
        
        stageData.forEach((data) => {
            totalHours += data.estimatedHours;
            totalCost += calculateStageCost(data);
        });
        
        // Calculate complexity
        const stageCount = selectedStages.size;
        if (stageCount >= 5 || totalHours >= 24) {
            complexity = 'Very Complex';
        } else if (stageCount >= 3 || totalHours >= 12) {
            complexity = 'Complex';
        } else if (stageCount >= 2 || totalHours >= 4) {
            complexity = 'Medium';
        }
        
        // Update summary elements
        const stageCountEl = document.getElementById('summaryStageCount');
        const totalHoursEl = document.getElementById('summaryTotalHours');
        const totalCostEl = document.getElementById('summaryTotalCost');
        const complexityEl = document.getElementById('summaryComplexity');
        
        if (stageCountEl) stageCountEl.textContent = stageCount;
        if (totalHoursEl) totalHoursEl.textContent = `${totalHours.toFixed(1)}h`;
        if (totalCostEl) totalCostEl.textContent = `$${totalCost.toFixed(0)}`;
        if (complexityEl) complexityEl.textContent = complexity;
        
        // Update stage execution order
        updateStageExecutionOrder();
        
        // Store for wizard integration
        window.selectedStageData = {
            stages: stageData,
            stageCount: stageCount,
            totalDuration: totalHours,
            totalCost: totalCost,
            complexityLevel: complexity
        };
    }
    
    function updateStageExecutionOrder() {
        const orderContainer = document.getElementById('stageExecutionOrder');
        if (!orderContainer) return;
        
        const sortedStages = Array.from(stageData.values()).sort((a, b) => a.executionOrder - b.executionOrder);
        
        const orderHtml = sortedStages.map((data, index) => `
            <span class="badge bg-secondary me-1">
                ${data.executionOrder}. ${data.name}
                <small class="ms-1">(${data.estimatedHours}h)</small>
            </span>
        `).join('');
        
        orderContainer.innerHTML = orderHtml || '<span class="text-muted">No stages selected</span>';
    }
    
    function generateHiddenInputs() {
        const container = document.getElementById('stageInputsContainer');
        if (!container) return;
        
        let inputsHtml = '';
        let index = 0;
        
        // Sort stages by execution order for consistent form submission
        const sortedStages = Array.from(stageData.values()).sort((a, b) => a.executionOrder - b.executionOrder);
        
        sortedStages.forEach((data) => {
            inputsHtml += `
                <input type="hidden" name="SelectedStageIds[${index}]" value="${data.id}" />
                <input type="hidden" name="StageExecutionOrders[${index}]" value="${data.executionOrder}" />
                <input type="hidden" name="StageEstimatedHours[${index}]" value="${data.estimatedHours}" />
                <input type="hidden" name="StageHourlyRates[${index}]" value="${data.hourlyRate}" />
                <input type="hidden" name="StageMaterialCosts[${index}]" value="${data.materialCost}" />
            `;
            index++;
        });
        
        container.innerHTML = inputsHtml;
        console.log(`?? [STAGES] Generated ${index} hidden inputs for form submission`);
    }
    
    function notifyWizard() {
        // Notify the wizard of changes
        if (window.partsWizard && typeof window.partsWizard.onStageSelectionChanged === 'function') {
            window.partsWizard.onStageSelectionChanged(selectedStages);
        }
        
        // Dispatch custom event
        const event = new CustomEvent('stageConfigurationChanged', {
            detail: {
                selectedStages: Array.from(selectedStages),
                stageData: Object.fromEntries(stageData),
                summary: window.selectedStageData
            }
        });
        document.dispatchEvent(event);
    }
    
    function showErrorState() {
        const container = document.getElementById('stageButtonsContainer');
        if (container) {
            container.innerHTML = `
                <div class="text-center py-4 text-danger">
                    <i class="fas fa-exclamation-circle fa-2x mb-3"></i>
                    <h6>Error Loading Stages</h6>
                    <p>There was an error loading the production stages. Please refresh the page or contact support.</p>
                    <button type="button" class="btn btn-outline-primary" onclick="window.location.reload()">
                        <i class="fas fa-refresh me-1"></i>Retry
                    </button>
                </div>
            `;
        }
    }
    
    // Expose functions globally for debugging
    window.stagesManager = {
        getSelectedStages: () => Array.from(selectedStages),
        getStageData: () => Object.fromEntries(stageData),
        refresh: initializeEnhancedStageManager,
        debug: () => {
            console.log('?? [STAGES] Debug Info:');
            console.log('Available stages:', availableStages);
            console.log('Selected stages:', Array.from(selectedStages));
            console.log('Stage data:', Object.fromEntries(stageData));
        }
    };
    
    console.log('?? [STAGES] Enhanced stage manager ready, exposed as window.stagesManager');
})();
</script>

<style>
/* Enhanced Stage Manager Styles */
.stage-selection-btn {
    min-height: 120px;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.stage-selection-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.stage-selection-btn.btn-success {
    background: linear-gradient(135deg, #28a745, #20c997);
    border-color: #28a745;
    color: white;
}

.stage-selection-btn.btn-outline-secondary:hover {
    background-color: #f8f9fa;
    border-color: #007bff;
    color: #007bff;
}

.form-control-sm {
    font-size: 0.8rem;
}

.card-header small {
    font-size: 0.75rem;
}

#stageExecutionOrder .badge {
    font-size: 0.8rem;
    margin-bottom: 0.25rem;
}
</style>
